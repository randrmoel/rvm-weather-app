<!DOCTYPE html>
 <html > 
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Weather Application</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" crossorigin="anonymous">
        <link rel="stylesheet" href="./style.css">
    </head>


    <body>
        <div class = "container">
            <div style="width:100%" class = "jumbotron text-center vertical-center">
                <h1>Weather Dashboard</h1>
            </div>
            <div class = "row">
                <div style = "padding-top:1%" class = "col-sm-4"><!--Div for Search and prepend-->
                    <h3>Search for a City:</h3>
                    <div class="input-group mb-3">
                        <input id="txtbx" type="text" class="form-control"> 
                        <div class="input-group-append">
                          <button class="btn btn-primary" type="button" id="button-addon2">
                              <i class="fa fa-search"></i>
                          </button>
                        </div>
                      </div>
                      <ul id="city" class="list-group"><!--Cities prepend here--></ul>
                </div>
                <br>
                <div style="padding-top:1%" class = "col-sm-8">
                    <div class="wthr-summ row">
                        <div class="col-sm-12">
                            <h3 id="dispCity">City</h3>
                            <h4>Temperature:<span id="dispTmp"></span></h4>
                            <h4>Humidity:<span  id="dispHum"></span></h4>
                            <h4>Wind Speed:<span id="dispWnd"> </span></h4>
                            <h4>UV Index:<span style="color:white; margin-left:2px; padding-right:5px" id="dispUV"></span></h4>
                        </div>
                    </div> <!--End Internal Row-->
                    <br>
                    <div class = "row">
                        <div class = "col-sm-12">
                            <h3>Five Day Forecast:</h3>
                        </div>
                    </div> <!--End Internal Row-->

                    <div class = "rowcard row">
                        <div class ="colcard col-sm">
                            <div class="card" >
                                <div class="card-body">
                                  <h6 id="Date-0" class="card-title">Date 0</h6>
                                  <h6 id = "Weather-Icon-0" class="card-img"><img  style='width:90%; padding:0; margin:0' src="http://openweathermap.org/img/wn/01d@2x.png"></h6>
                                  <h6 id="Temp-0"  class="card-text"> Temp </h6>
                                  <h6 id = "Hum-0" class="card-text"> Humidity</h6>
                                </div>        
                            </div> <!--Card 0-->
                        </div> <!--End Column-->
                        
                        <div class ="colcard col-sm">
                            <div class="card">
                                <div class="card-body">
                                  <h6 id="Date-1" class="card-title">Date 1</h6>
                                  <h6 id = "Weather-Icon-1" class="card-img"><img  style='width:90%; padding:0; margin:0' src="http://openweathermap.org/img/wn/01d@2x.png"></h6>
                                  <h6 id="Temp-1"  class="card-text"> Temp </h6>
                                  <h6 id = "Hum-1" class="card-text"> Humidity</h6>
                                </div>        
                            </div> <!--Card 1-->
                        </div> <!--End Column-->

                        <div class = "colcard col-sm">
                            <div class="card" >
                                <div class="card-body">
                                  <h6 id="Date-2" class="card-title">Date 2</h6>
                                  <h6 id = "Weather-Icon-2" class="card-img"><img  style='width:90%;padding:0; margin:0' src="http://openweathermap.org/img/wn/01d@2x.png"></h6>
                                  <h6 id="Temp-2"  class="card-text"> Temp </h6>
                                  <h6 id = "Hum-2" class="card-text"> Humidity</h6>
                                </div>        
                            </div> <!--Card 2-->
                        </div> <!--End Column-->

                        <div class = "colcard col-sm">
                            <div class="card" >
                                <div class="card-body">
                                  <h6 id="Date-3" class="card-title">Date 3</h6>
                                  <h6 id = "Weather-Icon-3" class="card-img"><img  style='width:90%; padding:0; margin:0' src="http://openweathermap.org/img/wn/01d@2x.png"></h6>
                                  <h6 id = "Temp-3"  class="card-text"> Temp </h6>
                                  <h6 id = "Hum-3" class="card-text"> Humidity</h6>
                                </div>        
                            </div> <!--Card 3-->
                        </div> <!--End Column-->

                        <div class = "colcard col-sm">
                            <div class="card" >
                                <div class="card-body">
                                  <h6 id="Date-4" class="card-title">Date 4</h6>
                                  <h6 id = "Weather-Icon-4" class="card-img"><img  style='width:90%; padding:0; margin:0' src="http://openweathermap.org/img/wn/01d@2x.png"></h6>
                                  <h6 id = "Temp-4"  class="card-text"> Temp </h6>
                                  <h6 id = "Hum-4" class="card-text"> Humidity</h6>
                                </div>        
                            </div> <!--Card 4-->
                        </div> <!--End Column-->
                    </div> <!--End Row-->
                </div> <!--End 2nd Outer Column-->
            </div> <!--End Row-->
        </div><!--End Container-->

        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.4.1.min.js" crossorigin="anonymous"></script>
        <script type="text/javascript">
var inTxt="";
var iconPic = "";
var lat="";
var lng="";
var m = moment();
var nowDate = m.format("MM/DD/YYYY");

// Need another button listener for the added cities to recall the forcast

function addCity(cityName){
    newLi = $("<li>").text(cityName).attr("class","list-group-item");
    $("#city").prepend(newLi);
}

function clrInput(){
    $("#txtbx").val("");
}

function clrCity(){
    $("#city").empty();
}

function uviColor(uvIndx){
    n = parseFloat(uvIndx);

    if (n <=2) {
        return "#76A942";
    } else if (n<=5) {
        return "#F7ED00";
    } else if (n<=7) {
        return "#E1AF33";
    } else if (n<=10) {
        return "#C42B00";
    } else {
        return "#603BBF";
    }
}

function runQuery(inCity){
    qBlnk1 = "https:\\api.openweathermap.org/data/2.5/weather?q=";
    qBlnk2 = "https:\\api.openweathermap.org/data/2.5/forecast?q=";

    Units = "&units=imperial"; 
    API = "&APPID=7872f4a78b77312be971aa3219f71aef";
    qNow = qBlnk1+inCity+Units+API;
    
    qFutr = qBlnk2+inCity+Units+API;

    addCity(inCity);
    clrInput();
        $.ajax(
            {url:qNow,
            type:"GET"
            }).then(function(resp){
                iconPic = "http://openweathermap.org/img/wn/"+resp.weather[0].icon+"@2x.png";

                $("#dispCity").html(inCity + " (" + nowDate +")" + "<img  style='vertical-align:middle; width:6%; padding:0; margin:0' src="+ iconPic + ">");
                $("#dispTmp").html(" "+parseFloat(resp.main.temp).toFixed(1) + "<span>&#176</span>" +"F");
                $("#dispHum").text(" "+resp.main.humidity+"%")
                $("#dispWnd").text(" "+resp.wind.speed + " MPH")
                //UV Index Requires Latitude and Longitude and is a separate call
                lng=resp.coord.lon;
                lat=resp.coord.lat;

                qUVI = "https:\\api.openweathermap.org/data/2.5/uvi?lat="+lat+"&lon="+lng;
                qU = qUVI + API;
            
                $.ajax(
                    {url:qU,
                    type:"GET"
                    }).then(function(resp2){
                        uvTxt = parseFloat(resp2.value).toFixed(1);
                        $("#dispUV").text(" " + uvTxt +" ");
                        // get the appropriate background color
                        color = uviColor(uvTxt); 
                        $("#dispUV").attr("style", "background-color:" + color + "; color:white; margin-left:2px; padding-right:5px");
                }); // End of nexted ajax call 1
        }); // End of outer ajax call 1

        $.ajax(
            {url:qFutr,
            type:"GET"
        }).then(function(resp3){
            frcstArry = [];
            console.log(resp3);
            for(i=0; i<resp3.list.length; i++){
                if (resp3.list[i].dt_txt.indexOf("15:00:00") !== -1){
                    frcstArry.push(resp3.list[i]);
                }
            }
            console.log(frcstArry);
            for(i=0; i<5; i++){
                dateStr = ["#Date-0", "#Date-1", "#Date-2", "#Date-3", "#Date-4"];
                iconStr = ["#Weather-Icon-0", "#Weather-Icon-1", "#Weather-Icon-2", "#Weather-Icon-3", "#Weather-Icon-4"];
                tempStr = ["#Temp-0", "#Temp-1", "#Temp-2", "#Temp-3", "#Temp-4"];
                humStr = ["#Hum-0", "#Hum-1", "#Hum-2", "#Hum-3", "#Hum-4"];
                dt = frcstArry[i].dt_txt;
                dt = dt.substring(5,7) + "/" + dt.substring(8,10) + "/" + dt.substring(0,4);
                dt = dt.trim();
                console.log(dt);
                
                $(dateStr[i]).text(dt);
   
                icon = frcstArry[i].weather[0].icon;
                iconPic = "http://openweathermap.org/img/wn/"+icon+"@2x.png";
                console.log(iconPic);
                $(iconStr[i]).html("<img style='width:90%; padding:0; margin:0' src="+ iconPic + ">");
                $(tempStr[i]).html(parseFloat(frcstArry[i].main.temp).toFixed(1) + "&#176" +"F");
                $(humStr[i]).text(frcstArry[i].main.humidity+"%")
            }
        }); //End of outer ajax call for forecast
}

clrCity();

$(".btn").on("click", function(e){
    e.preventDefault();
    inCity = $.trim($("#txtbx").val());
    runQuery(inCity);
}); // End of button listener 1

$("#city").on("click", function(e){
    e.preventDefault();
    e.stopPropagation();
    whcCity = $(event.target).text();
    runQuery(whcCity); 
});        
        
        
        </script>
    </body>
</html>